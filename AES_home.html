<html>
<head>
	<link rel="stylesheet" type="text/css" href="AES.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous"/>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
<title>AES - Advanced Encryption Standard</title>
<script>
function populateMatrix()	{
	for (var i=0;i<16;i++)	{
		//alert(document.getElementsByName("hByte"+i)[0].value);
		document.getElementsByName("0hMatrix"+i)[0].value = document.getElementsByName("hByte"+i)[0].value;
	}
}

var Sbox = new Array(99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,
  118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,
  147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,
  7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,
  47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,
  251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,
  188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,
  100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,
  50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,
  78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,
  116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,
  158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,
  137,13,191,230,66,104,65,153,45,15,176,84,187,22);
  
function subBytes(num)	{
	for (var i=0;i<16;i++)	{
		hexVal = parseInt(document.getElementsByName(num+"aMatrix"+i)[0].value,16);
		document.getElementsByName(num+"sMatrix"+i)[0].value = Sbox[hexVal].toString(16);
	}
}

function shiftRows(num)	{
	//ToDo: this is so ugly, make smaller using division of i
	for (var i=0;i<4;i++)	{
		document.getElementsByName(num+"shMatrix"+i)[0].value = document.getElementsByName(num+"sMatrix"+i)[0].value;
	}
	for (var i=4;i<7;i++)	{
		document.getElementsByName(num+"shMatrix"+i)[0].value = document.getElementsByName(num+"sMatrix"+(i+1))[0].value;
	}
	for (var i=15;i>12;i--)	{
		document.getElementsByName(num+"shMatrix"+i)[0].value = document.getElementsByName(num+"sMatrix"+(i-1))[0].value;
	}
	document.getElementsByName(num+"shMatrix7")[0].value = document.getElementsByName(num+"sMatrix4")[0].value;
	document.getElementsByName(num+"shMatrix8")[0].value = document.getElementsByName(num+"sMatrix10")[0].value;
	document.getElementsByName(num+"shMatrix9")[0].value = document.getElementsByName(num+"sMatrix11")[0].value;
	document.getElementsByName(num+"shMatrix10")[0].value = document.getElementsByName(num+"sMatrix8")[0].value;
	document.getElementsByName(num+"shMatrix11")[0].value = document.getElementsByName(num+"sMatrix9")[0].value;
	document.getElementsByName(num+"shMatrix12")[0].value = document.getElementsByName(num+"sMatrix15")[0].value;
}

function mixColumns(num)	{
	for (var i=12;i<16;i++)	{
		document.getElementsByName(num+"mcMatrix"+(i-12))[0].value = (aes_mul(2,parseInt(document.getElementsByName(num+"shMatrix"+(i-12))[0].value,16)) ^ aes_mul(3,parseInt(document.getElementsByName(num+"shMatrix"+(i-8))[0].value,16)) ^ parseInt(document.getElementsByName(num+"shMatrix"+(i-4))[0].value,16) ^ parseInt(document.getElementsByName(num+"shMatrix"+i)[0].value,16)).toString(16);
		document.getElementsByName(num+"mcMatrix"+(i-8))[0].value = (parseInt(document.getElementsByName(num+"shMatrix"+(i-12))[0].value,16) ^ aes_mul(2,parseInt(document.getElementsByName(num+"shMatrix"+(i-8))[0].value,16)) ^ aes_mul(3,parseInt(document.getElementsByName(num+"shMatrix"+(i-4))[0].value,16)) ^ parseInt(document.getElementsByName(num+"shMatrix"+i)[0].value,16)).toString(16);
		document.getElementsByName(num+"mcMatrix"+(i-4))[0].value = (parseInt(document.getElementsByName(num+"shMatrix"+(i-12))[0].value,16) ^ parseInt(document.getElementsByName(num+"shMatrix"+(i-8))[0].value,16) ^ aes_mul(2,parseInt(document.getElementsByName(num+"shMatrix"+(i-4))[0].value,16)) ^ aes_mul(3,parseInt(document.getElementsByName(num+"shMatrix"+i)[0].value,16))).toString(16);
		document.getElementsByName(num+"mcMatrix"+i)[0].value = (aes_mul(3,parseInt(document.getElementsByName(num+"shMatrix"+(i-12))[0].value,16)) ^ parseInt(document.getElementsByName(num+"shMatrix"+(i-8))[0].value,16) ^ parseInt(document.getElementsByName(num+"shMatrix"+(i-4))[0].value,16) ^ aes_mul(2,parseInt(document.getElementsByName(num+"shMatrix"+i)[0].value,16))).toString(16);
	}
}

//the below function was ripped from http://people.eku.edu/styere/Encrypt/JS-AES.html
function aes_mul( a, b )	{
   var res = 0;
   while( a > 0 )	{
      if ( (a&1) != 0 )
         res = res ^ b;		// "add" to the result
      a >>>= 1;			// shift a to get next higher-order bit
      b <<= 1;			// shift multiplier also
   }
   // now reduce it modulo x**8 + x**4 + x**3 + x + 1
   var hbit = 0x10000;		// bit to test if we need to take action
   var modulus = 0x11b00;	// modulus - XOR by this to change value
   while( hbit >= 0x100 )	{
      if ( (res & hbit) != 0 )		// if the high-order bit is set
         res ^= modulus;	// XOR with the modulus

      // prepare for the next loop
      hbit >>= 1;
      modulus >>= 1;
   }
   return res;
}

function expandKey()	{
	for (var i=0;i<16;i++)	{
		document.getElementsByName("0kMatrix"+i)[0].value = document.getElementsByName("kByte"+i)[0].value;
	}
	var RCON = [0x00, 0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0x1b, 0x36];
	
	for (var i=1;i<11;i++)	{
		document.getElementsByName(i+"kMatrix0")[0].value = (parseInt(document.getElementsByName((i-1)+"kMatrix0")[0].value,16) ^ RCON[i] ^ Sbox[parseInt(document.getElementsByName((i-1)+"kMatrix13")[0].value,16)]).toString(16);
		document.getElementsByName(i+"kMatrix1")[0].value = (parseInt(document.getElementsByName((i-1)+"kMatrix1")[0].value,16) ^ Sbox[parseInt(document.getElementsByName((i-1)+"kMatrix14")[0].value,16)]).toString(16);
		document.getElementsByName(i+"kMatrix2")[0].value = (parseInt(document.getElementsByName((i-1)+"kMatrix2")[0].value,16) ^ Sbox[parseInt(document.getElementsByName((i-1)+"kMatrix15")[0].value,16)]).toString(16);
		document.getElementsByName(i+"kMatrix3")[0].value = (parseInt(document.getElementsByName((i-1)+"kMatrix3")[0].value,16) ^ Sbox[parseInt(document.getElementsByName((i-1)+"kMatrix12")[0].value,16)]).toString(16);

		for (var j=4;j<16;j++)	{
			document.getElementsByName(i+"kMatrix"+j)[0].value = (parseInt(document.getElementsByName((i-1)+"kMatrix"+j)[0].value,16) ^ parseInt(document.getElementsByName(i+"kMatrix"+(j-4))[0].value,16)).toString(16);
		}
	}
	
	for (var i=0;i<11;i++)	{
		var temp = document.getElementsByName(i+"kMatrix4")[0].value;
		document.getElementsByName(i+"kMatrix4")[0].value = document.getElementsByName(i+"kMatrix1")[0].value;
		document.getElementsByName(i+"kMatrix1")[0].value = temp;
		temp = document.getElementsByName(i+"kMatrix8")[0].value;
		document.getElementsByName(i+"kMatrix8")[0].value = document.getElementsByName(i+"kMatrix2")[0].value;
		document.getElementsByName(i+"kMatrix2")[0].value = temp;
		temp = document.getElementsByName(i+"kMatrix12")[0].value;
		document.getElementsByName(i+"kMatrix12")[0].value = document.getElementsByName(i+"kMatrix3")[0].value;
		document.getElementsByName(i+"kMatrix3")[0].value = temp;
		temp = document.getElementsByName(i+"kMatrix13")[0].value;
		document.getElementsByName(i+"kMatrix13")[0].value = document.getElementsByName(i+"kMatrix7")[0].value;
		document.getElementsByName(i+"kMatrix7")[0].value = temp;
		temp = document.getElementsByName(i+"kMatrix14")[0].value;
		document.getElementsByName(i+"kMatrix14")[0].value = document.getElementsByName(i+"kMatrix11")[0].value;
		document.getElementsByName(i+"kMatrix11")[0].value = temp;
		temp = document.getElementsByName(i+"kMatrix9")[0].value;
		document.getElementsByName(i+"kMatrix9")[0].value = document.getElementsByName(i+"kMatrix6")[0].value;
		document.getElementsByName(i+"kMatrix6")[0].value = temp;
	}
}

function addRoundKey(num)	{
	if (num != 0)	{
		if (num != 10)	{
			for (var i=0;i<16;i++)	{
				document.getElementsByName(num+"aMatrix"+i)[0].value = (parseInt(document.getElementsByName(num+"kMatrix"+i)[0].value,16) ^ parseInt(document.getElementsByName((num-1)+"mcMatrix"+i)[0].value,16)).toString(16);
			}
		}
	} else {
		for (var i=0;i<16;i++)	{
			document.getElementsByName("0aMatrix"+i)[0].value = (parseInt(document.getElementsByName("0kMatrix"+i)[0].value,16) ^ parseInt(document.getElementsByName("0hMatrix"+i)[0].value,16)).toString(16);
		}
	}
	
	if (num == 10)	{
		for (var i=0;i<16;i++)	{
			document.getElementsByName("10aMatrix"+i)[0].value = (parseInt(document.getElementsByName("10kMatrix"+i)[0].value,16) ^ parseInt(document.getElementsByName("9shMatrix"+i)[0].value,16)).toString(16);
		}
		for (var i=0;i<16;i++)	{
			document.getElementsByName("10aMatrix"+i)[1].value = document.getElementsByName("10aMatrix"+i)[0].value;
		}
	}
}

function allSteps()	{
	populateMatrix();
	addRoundKey(0);
	subBytes(0);
	shiftRows(0);
	mixColumns(0);
	addRoundKey(1);
	subBytes(1);
	shiftRows(1);
	mixColumns(1);
	addRoundKey(2);
	subBytes(2);
	shiftRows(2);
	mixColumns(2);
	addRoundKey(3);
	subBytes(3);
	shiftRows(3);
	mixColumns(3);
	addRoundKey(4);
	subBytes(4);
	shiftRows(4);
	mixColumns(4);
	addRoundKey(5);
	subBytes(5);
	shiftRows(5);
	mixColumns(5);
	addRoundKey(6);
	subBytes(6);
	shiftRows(6);
	mixColumns(6);
	addRoundKey(7);
	subBytes(7);
	shiftRows(7);
	mixColumns(7);
	addRoundKey(8);
	subBytes(8);
	shiftRows(8);
	mixColumns(8);
	addRoundKey(9);
	subBytes(9);
	shiftRows(9);
	addRoundKey(10);
}


//ToDo: this function doesn't work when called with parameter 'round = 9' , fix it
function restOfSteps(curStep,round)	{
	//first perform steps to get to start of next round
	if (curStep == "addRoundKey")	{
		subBytes(round);
		shiftRows(round);
		mixColumns(round);
	}
	if (curStep == "subBytes")	{
		shiftRows(round);
		mixColumns(round);
	}
	if (curStep == "shiftRows")	{
		mixColumns(round);
	}
	//perform all of the remaining rounds
	for (var i = (round+1);i < 10; i++)	{
		addRoundKey(i);
		subBytes(i);
		shiftRows(i);
		if (i != 9)	{
			mixColumns(i);
		}
	}
	addRoundKey(10);
}

//	ToDo:
//	-- create a page for the key expansion
function save() {
        hByte0 = document.getElementById('hByte0').value;
        hByte1 = document.getElementById('hByte1').value;
        hByte2 = document.getElementById('hByte2').value;
        hByte3 = document.getElementById('hByte3').value;
        hByte4 = document.getElementById('hByte4').value;
        hByte5 = document.getElementById('hByte5').value;
        hByte6 = document.getElementById('hByte6').value;
        hByte7 = document.getElementById('hByte7').value;
        hByte8 = document.getElementById('hByte8').value;
        hByte9 = document.getElementById('hByte9').value;
        hByte10 = document.getElementById('hByte10').value;
        hByte11 = document.getElementById('hByte11').value;
        hByte12 = document.getElementById('hByte12').value;
        hByte13 = document.getElementById('hByte13').value;
        hByte14 = document.getElementById('hByte14').value;
        hByte15 = document.getElementById('hByte15').value;
        localStorage.setItem('hByte0', hByte0);
        localStorage.setItem('hByte1', hByte1);
        localStorage.setItem('hByte2', hByte2);
        localStorage.setItem('hByte3', hByte3);
        localStorage.setItem('hByte4', hByte4);
        localStorage.setItem('hByte5', hByte5);
        localStorage.setItem('hByte6', hByte6);
        localStorage.setItem('hByte7', hByte7);
        localStorage.setItem('hByte8', hByte8);
        localStorage.setItem('hByte9', hByte9);
        localStorage.setItem('hByte10', hByte10);
        localStorage.setItem('hByte11', hByte11);
        localStorage.setItem('hByte12', hByte12);
        localStorage.setItem('hByte13', hByte13);
        localStorage.setItem('hByte14', hByte14);
        localStorage.setItem('hByte15', hByte15);
	
		kByte0 = document.getElementById('kByte0').value;
        kByte1 = document.getElementById('kByte1').value;
        kByte2 = document.getElementById('kByte2').value;
        kByte3 = document.getElementById('kByte3').value;
        kByte4 = document.getElementById('kByte4').value;
        kByte5 = document.getElementById('kByte5').value;
        kByte6 = document.getElementById('kByte6').value;
        kByte7 = document.getElementById('kByte7').value;
        kByte8 = document.getElementById('kByte8').value;
        kByte9 = document.getElementById('kByte9').value;
        kByte10 = document.getElementById('kByte10').value;
        kByte11 = document.getElementById('kByte11').value;
        kByte12 = document.getElementById('kByte12').value;
        kByte13 = document.getElementById('kByte13').value;
        kByte14 = document.getElementById('kByte14').value;
        kByte15 = document.getElementById('kByte15').value;
        localStorage.setItem('kByte0', kByte0);
        localStorage.setItem('kByte1', kByte1);
        localStorage.setItem('kByte2', kByte2);
        localStorage.setItem('kByte3', kByte3);
        localStorage.setItem('kByte4', kByte4);
        localStorage.setItem('kByte5', kByte5);
        localStorage.setItem('kByte6', kByte6);
        localStorage.setItem('kByte7', kByte7);
        localStorage.setItem('kByte8', kByte8);
        localStorage.setItem('kByte9', kByte9);
        localStorage.setItem('kByte10', kByte10);
        localStorage.setItem('kByte11', kByte11);
        localStorage.setItem('kByte12', kByte12);
        localStorage.setItem('kByte13', kByte13);
        localStorage.setItem('kByte14', kByte14);
        localStorage.setItem('kByte15', kByte15);}

</script>
</head>
<body>


<div>

<div class="pad d-flex justify-content-center">
<h1 style="font-size:4vw">AES VISUALIZER AND ENCRYPTION</h1>
</div>

<div class="d-flex flex-row  justify-content-center">
<div class="plain">
<p class="Common">Plaintext (in hex): <br />
	<input style="margin-bottom:5px" type="text" name="hByte0" maxlength="2" size="2"  id ="hByte0">
	<input style="margin-bottom:5px" type="text" name="hByte1" maxlength="2" size="2"  id ="hByte1" >
	<input style="margin-bottom:5px" type="text" name="hByte2" maxlength="2" size="2"  id ="hByte2">
	<input style="margin-bottom:5px" type="text" name="hByte3" maxlength="2" size="2"  id ="hByte3"><br />
	<input style="margin-bottom:5px" type="text" name="hByte4" maxlength="2" size="2"  id ="hByte4">
	<input style="margin-bottom:5px" type="text" name="hByte5" maxlength="2" size="2"  id ="hByte5">
	<input style="margin-bottom:5px" type="text" name="hByte6" maxlength="2" size="2"  id ="hByte6">
	<input style="margin-bottom:5px" type="text" name="hByte7" maxlength="2" size="2"  id ="hByte7"><br />
	<input style="margin-bottom:5px" type="text" name="hByte8" maxlength="2" size="2"  id ="hByte8">
	<input style="margin-bottom:5px" type="text" name="hByte9" maxlength="2" size="2"  id ="hByte9">
	<input style="margin-bottom:5px" type="text" name="hByte10" maxlength="2" size="2"  id ="hByte10">
	<input style="margin-bottom:5px" type="text" name="hByte11" maxlength="2" size="2"  id ="hByte11"><br />
	<input style="margin-bottom:5px" type="text" name="hByte12" maxlength="2" size="2"  id ="hByte12">
	<input style="margin-bottom:5px" type="text" name="hByte13" maxlength="2" size="2"  id ="hByte13">
	<input style="margin-bottom:5px" type="text" name="hByte14" maxlength="2" size="2"  id ="hByte14">
	<input style="margin-bottom:5px" type="text" name="hByte15" maxlength="2" size="2"  id ="hByte15">
</p>
</div>

<div class="encryp">
<p class="Common">Encryption key (in hex): <br />
	<input style="margin-bottom:5px" type="text" name="kByte0" maxlength="2" size="2" id="kByte0">
	<input style="margin-bottom:5px" type="text" name="kByte1" maxlength="2" size="2" id="kByte1">
	<input style="margin-bottom:5px" type="text" name="kByte2" maxlength="2" size="2" id="kByte2">
	<input style="margin-bottom:5px" type="text" name="kByte3" maxlength="2" size="2" id="kByte3"><br />
	<input style="margin-bottom:5px" type="text" name="kByte4" maxlength="2" size="2" id="kByte4">
	<input style="margin-bottom:5px" type="text" name="kByte5" maxlength="2" size="2" id="kByte5">
	<input style="margin-bottom:5px" type="text" name="kByte6" maxlength="2" size="2" id="kByte6">
	<input style="margin-bottom:5px" type="text" name="kByte7" maxlength="2" size="2" id="kByte7"><br />
	<input style="margin-bottom:5px" type="text" name="kByte8" maxlength="2" size="2" id="kByte8">
	<input style="margin-bottom:5px" type="text" name="kByte9" maxlength="2" size="2" id="kByte9">
	<input style="margin-bottom:5px" type="text" name="kByte10" maxlength="2" size="2" id="kByte10">
	<input style="margin-bottom:5px" type="text" name="kByte11" maxlength="2" size="2" id="kByte11"><br />
	<input style="margin-bottom:5px" type="text" name="kByte12" maxlength="2" size="2" id="kByte12">
	<input style="margin-bottom:5px" type="text" name="kByte13" maxlength="2" size="2" id="kByte13">
	<input style="margin-bottom:5px" type="text" name="kByte14" maxlength="2" size="2" id="kByte14">
	<input style="margin-bottom:5px" type="text" name="kByte15" maxlength="2" size="2" id="kByte15">
    </p>
</div>
</div>
<div class="text-center d-flex flex-row justify-content-center">
    <button style="margin-right:20px" onclick="location.href='Rounds.html' ; save()">Round-wise Encryption</button>
    <!--<button onclick="location.href='Final.html' ; save()">Complete Encryption</button>-->
</div>
</div>
</body>
</html>

